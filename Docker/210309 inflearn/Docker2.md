### 도커 이미지 

> ```bash
> docker run 이미지 이름
> #docker : 도커 클라이언트 언급 
> #run : 컨테이너 생성 및 실행
> ```
>
> #### 이미지 내부 파일 시스템 구조 보기
>
> ```bash
> docker run 이미지 이름 ls
> ```
>
> 원하는 항목만 보기
>
> ```bash
> docker ps --format 'table{{.Names}}\table{{.Image}}'
> ```



### 도커 컨테이너의 생명주기

![docker_lifecycle](https://user-images.githubusercontent.com/52882578/112918339-9db84b00-913f-11eb-9a8e-11ea002ad13e.PNG)

#### STOP과 Kill

> Stop은 그동한 하던 작업들을 완료하고 컨테이너를 중지 시킨다.
>
> Kill은 Stop과 달리 어떤 것도 기다리지 않고 바로 컨테이너를 중지 시킨다.

#### 삭제하기

```bash
#컨테이너 삭제
docker rm <아이디/이름> # 실행중인 컨테이너는 먼저 중지후에 삭제 가능
#컨테이너 모두 삭제
docker rm `docker ps -a -q`
#이미지 삭제
docker rmi <이미지 id>
```

### 실행중인 컨테이너에 명령어 전달

```bash
docker exec <컨테이너 아이디>
```

#### exec

> 이미 실행중인 컨테이너에 명령어를 전달할 때 사용

```bash
#-it 를 입력해줘야 다음 작업을 진행할 수 있다.
docker exec -it <컨테이너 id> <컨테이터에 입력할 명령어>

# 명령어를 계속 입력해주어야 한다면 아래와 같이 컨테이너 내부에 쉘이나 터미널 환경으로 접속할 수 있다.
# sh을 사용하면 컨테이너 내부에서 작업할 수 있다.
docker exec -it <컨테이너 id> sh, bash,등등
```





### 도커 이미지 정리

> 도커 이미지는 컨테이너를 만들기 위해 필요한 소스코드나 라이브러리,  종속성들을 갖고 있는 소프트웨어 패키지이다.
>
> Dockerhub에 이미 다른 사람들이 만들어 놓은 것을을 이용할 수도 있으면, 직접 이미지를 만들어 올릴 수도 있다.
>
> 도커 이미지를 이용해서 도커 컨테이너 생성
>
> ```bash
> docker create <이미지 이름>
> ```
>
> #### 도커 이미지 생성하는 순서
>
> 1. Dockerfile 장성
>    * Dockerfile : 
>    * Docker Image를 만들기 위한 설정 파일이다.
>    * 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의해준다.
> 2. 도커 클라이언트
>    * 도커 파일에 입력된 내용이 도커 클라이언트에 전달이 되어야 한다.
> 3. 도커 서버
>    * 도커 클라이언트에 전달된 모든 중요한 작업들을 하는 곳
> 4. 이미지 생성



### Dockerile 만들기

#### 도커 파일이란

> 도커 이미지를 만들기 위한 설정 파일이며, 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의해주는 파일입니다.

#### 도커 파일 만드는 순서

> 도커 이미지가 필요한 것이 무엇인지를 생각하기.
>
> 도커는 여러개의 레이어로 되어 있다. 그중에서 베이스 이미지는 이 이미지의 기반이 되는 부분이다. 레이어는 중간 단계의 이미지라고 생각하면 된다.
>
> 만약 이미지에 무엇이 추가된다면 레이어가 추가 된다.(레이어 캐싱)

> 1. 베이스 이미지를 명시해준다. (파일 스냅샷에 해당한다.)
>    * 베이스 이미지는 OS라고 생각하자
> 2. 추가적으로 필요한 파일을 다운 받기 위한 명령어를 명시해준다. (파일 스냅샷에 해당한다,)
> 3. 컨테이너 시작시 실행 될 명령어를 명시해준다. (시작시 실행 될 명령어에 해당)

> **FROM** 
>
> * 이미지 생성시 기반이 되는 이미지 레이어
> * <이미지 이름>:<태그> 형식으로 작성
>   * ex) ubuntu:14.04
> * 태그를 안 붙이면 자동적으로 가장 최신것으로 다운 받음
>
> **RUN**
>
> * 도커 이미지가 생성되지 전에 수행할 쉘 명령어
>
> **CMD**
>
> * 컨테이너가 시작되었을 때 실행할 실행 파일 또는 셸 스크립트.
> * 해당 명령어는 DockerFile내 1회만 쓸 수 있습니다.

> 도커 파일
>
> ```dockerfile
> #베이스 이미지를 명시해준다.
> FROM alpine
> 
> #추가적으로 필요한 파일들을 다운로드 받는다
> # RUN command
> 
> #컨테이너 시작시 실행 될 명령어를 명시해준다.
> CMD ["echo", "hello"]
> ```
>
> 도커 파일을 만든 후 빌드
>
> ```bash
> docker build ./
> 
> #빌드 후
> Sending build context to Docker daemon  2.048kB
> Step 1/2 : FROM alpine #alpine 베이스 이미지를 가져옴
>  ---> 302aba9ce190 #alpine 이미지의 id
> Step 2/2 : CMD ["echo", "hello"] 
>  ---> Running in b93e614d4f87 #b93e614d4f87 임시 컨테이너 안에서 위 명령어 실행
> Removing intermediate container b93e614d4f87 #임시 컨테이너 삭제
>  ---> 029d4d82bef8 #이미지 생성
> Successfully built 029d4d82bef8
> ```
>
> #### 결론
>
> 베이스 이미지에서 다른 종속성이나 새로운 커맨드를 추가할 때는 임시 컨테이너를 만든 후 그 컨테이너를 토대로 새로운 이미지를 만든다!! 그리고 임시 컨테이너는 지워준다.



### 도커 이미지에 이름 주는 방법

```bash
#원래 build
docker build

#이름 주는 build
docker build -t <나의 도커 아이디>/<저장소/프로젝트 이름>:<version> .
```
