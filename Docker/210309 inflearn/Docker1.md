### 도커를 사용하는 이유?

* 컨테이너는 vm 보다 빠르고 가볍다
  * 하이퍼바이저와 게스트 OS가 필요했던 것과는 달리, 컨테이너는 운영 체제를 제외하고 어플리케이션 실행에 필요한 모든 파일만 패키징 하기 때문
* 개발했던 환경을 그대로 배포할 수 있다. (배포가 쉽다)
* AWS, Azure 등 어디서든 실행이 가능하다.



### 도커란

> **컨테이너**를 사용하여 응용프로그램을 더 쉽게 만들고 배포하고 실행할 수 있도록 설계된 도구이며 **컨테이너 기반**의 오픈소스 가상화 플랫폼이다.



### 컨테이너

> 호스트 운영체제의 커널을 공유하면서 격리된 컴퓨팅 자원을 제공하는 가상화 기술이다. (컴퓨터 한 대라고 생각하자)
>
> 다양한 프로그램, 다양한 운영체제 및 실행 환경을 컨테이너로 추상화 하여서 동일한 인터페이스를 제공하여 프로그램 배포 및 관리를 단순하게 해준다.
>
> * 인터페이스는 사용자가 기기를 쉽게 동작시키는데 도움을 주는 시스템을 의미한다.
>
> AWS, Azure 등 어디서든 실행이 가능하다.
>
> #### 장점
>
> VM보다 가볍고 빠르다.
>
> 자원의 낭비가 발생하지 않는다. (커널 공유)
>
> docker image로 배포가 쉽다. 
>
> ##### 커널
>
> * 컴퓨터 내의 자원을 사용자 프로그램이 사용할 수 있도록 관리하는 프로그램이다.
> * 프로세스 관리, 메모리 관리 등등



### 도커 이미지와 컨테이너 정의

#### 컨테이너

> **컨테이너**는 코드와 모든 종속성을 패키지화하여 응용 프로그램이 한 컴퓨팅 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행되도록 하는 소프트웨어의 표준 단위이다.

#### 컨테이너 이미지

> **컨테이너 이미지**는 서비스 운영에 필요한 서버 프로그램, 소스코드 및 라이브러리, 컴파일된 실행 파일을 묶는 형태이다.
>
>  응용 프로그램을 실행하는데 **필요한 모든 것을 포함**하는 가볍고 독립적이며 실행 가능한 **소프트웨어 패키지**이다.
>
> 프로그램을 실행하는데 필요한 설정이나 종속성을 가지고 있다.
>
> 예를들어 우분투 이미지는 우분투를 실행하기 위한 모든 파일을 가지고 있다.
>
> 도커는 Dockerfile이라는 파일로 이미지를 만들다. Docker 파일에는 소스와 함께 의존성 패키지 등 사용했던 설정 파일을 버전 관리가 쉽도록 명시되어진다.

#### 핵심

> 도커 이미지는 프로그램을 실행하는데 필요한 설정이나 종속성을 갖고 있으며 도커 이미지를 이용해서 컨테이너를 생성하며 도커 컨테이너를 이용하여 프로그램을 실행한다.



### 리눅스로 시작

> 도커에서 자동으로 배포판 버전을 감지해서 알맞는 도커를 설치해 준다.
>
> ``` bash
> sudo wget -qO- http://get.docker.com/ | sh
> docker version
> docker login
> ```
>
> ##### sudo 없이 사용하기
>
> ```bash
> sudo usermod -aG docker $USER # 현재 접속중인 사용자에게 권한주기
> sudo usermod -aG docker your-user # your-user 사용자에게 권한주기
> ```
>
> 사용자가 로그인 중이라면 다시 로그인 후 권한이 적용된다.



### docker run

> 1. 도커 클라이언트에서 docker run hello-world 명령어 입력
> 2. 도커 서버에서 처리
> 3. hello-world image가 캐시 보관 장소에 있는지 확인
> 4. 캐시 보관 장소에 hello-world 이미지가 없으면 도커 허브에서 가져옴



### 하이퍼 바이저 기반

#### 가상화 기술이 나오기 전

* 한대의 서버를 하나의 용도로만 사용
* 남는 서버 공간 그대로 방치
* 하나의 서버에 하나의 운영체제, 하나의 프로그램만을 운영
* 안정적이나 비효율적

#### 하이퍼 파이저 기반의 가상화 출현

* 논리적으로 공간을 분할하여 **VM** 이라는 독립적인 가상 환경의 서버 이용 가능
* 하이퍼 바이저는 호스트 시스템에서 다수의 게스트 OS를 구동할 수 있게 하는 소프트웨어,
* 하드웨어를 가상화하면서 하드웨어와 각각의 VM을 모니터링 하는 중간 관리자이다.

> 호스트 OS : 리눅스 윈도우와 같은 실제 운영체제
>
> 게스트 OS : 하이퍼바이저 위에 만든 가상 머신에 설치된 운영체제



### 도커 컨테이너와 VM

![docker 작동](https://user-images.githubusercontent.com/52882578/112797051-cdb31000-90a5-11eb-9fac-040f68815ceb.png)

#### 공통점

> 도커 컨테이너와 가상 머신은 기본 하드웨어에서 **격리된 환경** 내에 애플리케이션을 배치하는 방법입니다.

#### 차이점

> 격리된 환경을 얼마나 격리를 시키는지의 차이가 있다.
>
> * 도커 컨테이너와 VM을 비교했을 때 도커 컨테이너는 하이퍼바이저와 게스트 OS가 필요하지 않으므로 **더 가볍다.** (오버헤드가 더 적다)
> * 애플리케이션을 실행할 때 컨테이너 방식에서는 호스트 OS 위에 도커 이미지만 배포하면 되는데, 
> * VM은 어플리케이션을 실행하기 위해서 VM을 띄우고 자원을 할당한 다음 게스트 OS를 부팅하여 어플리케이션을 실행 해야 해서 훨씬 복잡하고 무겁게 실행한다.
>
> 도커 컨테이너에서도 컨테이너가 제공하는 격리 기능이 있지만 **같은 호스트**의 (운영체제의) 다른 컨테이너와 **동일한 커널을 공유**한다.
>
> VM은 호스트 운영체제 또는 하이퍼바이저와 독립되어 있다. 

> #### 정리
>
> VM은 호스트 OS와 독립되어 있다. 컨테이너는 호스트 OS와 동일한 커널을 공유하며 프로세스 단위로 격리된다.
>
> VM은 하이퍼바이저와 게스트OS (무겁다) 가 필요하지만 Container는 OS를 제외하고 어플리케이션에 필요한 파일만 패키징 하기 때문에 더 가볍다.
>
> VM은 하드웨어 자원의 일부를 VM에 할당하여 자원의 낭비가 발생할 수 있지만 컨테이너는 호스트 OS의 자원을 컨테이너들끼리 공유하여 자원의 낭비가 발생하지 않는다.



| ㅇㅇㅇㅇㅇ | VM                                                      | Container                                                   |
| ---------- | ------------------------------------------------------- | ----------------------------------------------------------- |
|            | 가상화된 하드웨어 위에 os가 올라가는 형태로 host와 분리 | 컨테이너는 같은 호스트의 컨테이너와 동일한 커널을 공유한다. |
|            | GuestOS가 필요한다.                                     | 어플리케이션 실행에 필요한 파일만 패키징한다.               |
| 격리       | VM 마다 독립된 실행환경                                 | OS의 자원을 컨테이너들끼리 공유한다.                        |



#### 어떻게 도커 컨테이너가 격리가 되나

> 컨터에너와 호스트에서 실행되는 다른 프로세스 사이에 벽을 만드는 리눅스 커널 기능
>
> 도커에서 내부적으로 호스트OS 위에 리눅스 VM이 설치되어 있다.

C Groupe

* cpu와 메모리 사용 제한 가능

네임 스페이스

* 하나의 시스템에서 프로세스를 격리시킬 수 있는 가상화 기술



### 이미지로 컨테이너 만들기

> 이미지는 응용 프로그램을 실행하는데 필요한 모든 것을 포함하고 있다.
>
> 이미지 = 시작시 실행 될 명령어 + 파일 스냅샷

![container1](https://user-images.githubusercontent.com/52882578/112801727-31d8d280-90ac-11eb-8346-74341c623ad0.PNG)

![container2](https://user-images.githubusercontent.com/52882578/112801825-516ffb00-90ac-11eb-8de7-ab137ac0a1e4.PNG)

 위 사진 해석

> 컨테이너가 실행이 되면 명령어가 실행이 되고 커널을 지나 카카오톡 실행 파일을 작동시켜 kakaotalk이라는 프로그램을 실행시킨다.



